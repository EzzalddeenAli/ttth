<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/js/ttth/ttth.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/js/ttth/ttth.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @name updateTrayIconStatus
* @summary Updates the tray icon
* @description Checks the tabs of all services and fetches the content of the related batch. Based on the overall unread message account it triggers the update of the tray icon
*/
function updateTrayIconStatus()
{
    var overallUnreadMessages = 0;
    var curServiceUnreadMessageCount = 0;
    var serviceName = "";
    var currentTabId;

    // loop over all tabs - count unread messages
    $("#myTabs li a").each(function()
    {
        currentTabId = $(this).attr("id");

        if(currentTabId !== "target_Settings")
        {
            // FIXME
            currentTabId = currentTabId.replace("target_", "");

            console.log("updateTrayIconStatus ::: Check unread message badge of: _" + currentTabId + "_.");

            curServiceUnreadMessageCount = 0; // reset to 0
            curServiceUnreadMessageCount = $("#badge_" + currentTabId ).html();
            curServiceUnreadMessageCount = Number(curServiceUnreadMessageCount);

            // if the current service has a significant unread message count -> log it and add it to overall counter
            if( (curServiceUnreadMessageCount !== 0) &amp;&amp; (curServiceUnreadMessageCount !== "") &amp;&amp; (curServiceUnreadMessageCount !== null) )
            {
                console.log("updateTrayIconStatus ::: Unread messages count of service _" + serviceName + "_ is: " + curServiceUnreadMessageCount);

                // increate the overall counter
                overallUnreadMessages = overallUnreadMessages + curServiceUnreadMessageCount;
            }
        }
        else
        {
            console.log("updateTrayIconStatus ::: Ignoring settings-tab - as it has no badge.");
        }
    });

    console.log("updateTrayIconStatus ::: Overall unread message count is: _" + overallUnreadMessages + "_.");

    const {ipcRenderer} = require("electron");
    if( (overallUnreadMessages === "0" ) || (overallUnreadMessages === 0 ) )
    {
        // tray should show the default icon
        ipcRenderer.send("changeTrayIconToDefault");
    }
    else
    {
        // tray should show that we got unread messages
        ipcRenderer.send("changeTrayIconToUnreadMessages");
    }
}

/**
* @name updateServiceBadge
* @summary Updates the badge of a single service
* @description gets the name of a service and its current unread message count. Updates the badge of the related service
* @param serviceId - ID of the service
* @param count - Amount of unread messages
*/
function updateServiceBadge(serviceId, count)
{
    console.log("updateServiceBadge ::: New unread count for service _" + serviceId + "_ is: _" + count + "_.");

    if( (count === null) || (count === 0) || (count === "null"))
    {
        count = "";
    }

    // update the badge
    $( "#badge_" + serviceId).html( count );

    // Update tray icon status if needed
    updateTrayIconStatus();
}


/**
* @name addEventListenerForSingleService
* @summary Adds several EventListeners to the webview of the service
* @description Defines several EventListeners to the webview of the service and starts a periodic request to check for unread messages
*/
function addEventListenerForSingleService(serviceId, enableUnreadMessageHandling = true, enableLinkSupport = false)
{
    console.log("addEventListenerForSingleService ::: Start for service: _" + serviceId + "_.");
    console.log("addEventListenerForSingleService ::: Adding event listeners for webview: _webview_" + serviceId + "_.");

    // get webview
    var webview = document.getElementById("webview_" + serviceId);

    // run it periodically
    //
    //  5.000 =  5 sec
    var intervalID = setInterval(function()
    {
        webview.send("request");
    }, 5000);


    // WebView Events for UnreadMessageHandling
    //
    if(enableUnreadMessageHandling === true)
    {
        // WebView Event: did-start-loading
        //
        webview.addEventListener("did-start-loading", function()
        {
            console.log("addEventListenerForSingleService ::: did-start-loading.");

            // Triggering search for unread messages
            webview.send("request");
        });


        // WebView Event: dom-ready
        //
        webview.addEventListener("dom-ready", function()
        {
            console.log("addEventListenerForSingleService ::: DOM-Ready");

            // Triggering search for unread messages
            webview.send("request");
        });


        // WebView Event: did-stop-loading
        //
        webview.addEventListener("did-stop-loading", function()
        {
            console.log("addEventListenerForSingleService ::: did-stop-loading");

            // Debug: Open a separate Console Window for this WebView
            //webview.openDevTools();

            // Triggering search for unread messages
            webview.send("request");
        });


        // WebView Event:  ipc-message
        webview.addEventListener("ipc-message",function(event)
        {
            console.log("addEventListenerForSingleService ::: IPC message: _" + event + "_.");
            //console.log(event);
            //console.info(event.channel);

            // update the badge
            if(event.channel != null)
            {
                updateServiceBadge(serviceId, event.channel);
            }

        });
    }


    // WebView Event: new-window / clicking links
    //
    if(enableLinkSupport === true)
    {
        webview.addEventListener("new-window", function(e)
        {
            console.log("addEventListenerForSingleService ::: new-window");

            const BrowserWindow = require("electron");
            const shell = require("electron").shell;
            const protocol = require("url").parse(e.url).protocol;

            if (protocol === "http:" || protocol === "https:")
            {
                shell.openExternal(e.url);
            }
        });
    }

    console.log("addEventListenerForSingleService ::: End");
}


/**
* @name closeSingleServiceConfiguratationWindow
* @summary Triggers a function in main.js to close the single-service-configuration popup window
* @description Triggers a function in main.js to close the single-service-configuration popup window
*/
function closeSingleServiceConfiguratationWindow()
{
    const {ipcRenderer} = require("electron");
    ipcRenderer.send("closeConfigureSingleServiceWindow");
}


/**
* @name createSingleServiceConfiguration
* @summary Fetches the input values from the single-service-configuration popup window and creates a related service config
* @description Fetches the input values from the single-service-configuration popup window and creates a related service config
*/
function createSingleServiceConfiguration()
{
    alert("dummy")
}


// Storing the data from configServiceWindow
/**
* @name updateSingleServiceConfiguration
* @summary Fetches the input values from the single-service-configuration popup window and updates the related service config
* @description Fetches the input values from the single-service-configuration popup window and updates the related service config
*/
function updateSingleServiceConfiguration()
{
    const storage = require("electron-json-storage");

    // get values from configServiceWindow
    var serviceId = $("#input_serviceId").val();
    var serviceType = $("#input_serviceType").val(); // hidden
    var serviceName = $("#input_serviceName").val();
    var serviceIcon = $("#input_serviceIcon").val();
    var serviceUrl = $("#input_serviceUrl").val();
    var serviceInjectCode = $("#input_serviceInjectCode").val(); //hidden
    var serviceEnableStatus = $("#input_serviceEnableStatus").val(); //hidden
    if (serviceEnableStatus === "true")
    {
        serviceEnableStatus = true;
    }
    else {
        serviceEnableStatus = false;
    }

    // update the config of the configured service (status)
    storage.set(serviceId, {
        "type": serviceType,
        "name": serviceName,
        "icon": serviceIcon,
        "url": serviceUrl,
        "injectCode": serviceInjectCode,
        serviceEnableStatus: serviceEnableStatus
    }, function(error)
    {
        if (error) throw error;
    });

    console.log("updateSingleServiceConfiguration ::: Updating service config: _" + serviceId + "_.");

    closeSingleServiceConfiguratationWindow();
}


/**
* @name configureSingleUserService
* @summary Triggers a function in main.js to  open the single-service-configuration popup window
* @description Triggers a function in main.js to  open the single-service-configuration popup window
* @param serviceId - id of the service
*/
function configureSingleUserService(serviceId)
{
    console.log("configureSingleUserService ::: Trying to open service configure window for service: _" + serviceId + "_.");

    // send ipc to show second window
    const {ipcRenderer} = require("electron");
    ipcRenderer.send("showConfigureSingleServiceWindow", serviceId);
}


/**
* @name showNoty
* @summary Shows a noty notification
* @description Creates a notification using the noty framework
* @param type - Options: alert, success, warning, error, info/information
* @param message - notification text
*/
function showNoty(type, message, timeout = 3000)
{
    //const Noty = require("noty");

    new Noty({
        type: type,
        timeout: timeout,
        theme: "bootstrap-v4",
        layout: "bottom",
        text: message,
    }).show();
}


/**
* @name readLocalStorage
* @summary Read from local storage
* @description Reads a value stored in local storage (for a given key)
* @param key - Name of local storage key
* @return value - The value of the supplied key
*/
function readLocalStorage(key)
{
    var value = localStorage.getItem(key);
    console.log("readLocalStorage ::: key: _" + key + "_ - got value: _" + value +"_");
    return(value);
}


/**
* @name writeLocalStorage
* @summary Write to local storage
* @description Writes a value for a given key to local storage
* @param key - Name of local storage key
* @param value - New value
*/
function writeLocalStorage(key, value)
{
    console.log("writeLocalStorage ::: key: _" + key + "_ - new value: _" + value + "_");
    localStorage.setItem(key, value);
}


/**
* @name updateWindowTitle
* @summary Triggers an update title function in main.js
* @description Triggers an update title function in main.js. This is needed to update the app window title to display the current / frontmost service.
* @param TabName - Name of the current tab
*/
function updateWindowTitle(tabName)
{
    console.log("updateWindowTitle ::: Sending _" + tabName + "_ to main.js");

    const {ipcRenderer} = require("electron");
    ipcRenderer.send("updateWindowTitle", tabName);
}


/**
* @name isMac
* @summary Checks if the operating system type is mac/darwin or not
* @description Checks if the operating system type is mac/darwin or not
* @return value - Boolean: True if mac, false if not
*/
function isMac()
{
    var os = require("os");

    // os types:
    //
    // - Darwin
    // - Linux
    // - Windows_NT
    console.log("isMac ::: Detected operating system type is: " + os.type());
    if(os.type() === "Darwin")
    {
        return true;
    }
    else
    {
        return false;
    }
}



/**
* @name openDevTools
* @summary Toggles DevConsole
* @description Opens or closes the Developer Console inside the app
*/
function openDevTools()
{
    console.log("openDevTools ::: Opening Developer Console");
    const remote = require("electron").remote;
    remote.getCurrentWindow().toggleDevTools();
}


/**
* @name sendNotification
* @summary Send a notification
* @description Creates a desktop notification
* @param title- Title string for the notification
* @return message - Message string for the notification
*/
function sendNotification(title, message)
{
    console.log("sendNotification ::: Sending a notification with the title _" + title + "_ and the message: _" + message + "_.");

    let myNotification = new Notification(title, {
        body: message,
        icon: "img/notification/icon_notification.png"
    });

    /*
    myNotification.onclick = () => {
        console.log("Notification clicked")
    }
    */
}


/**
* @name  settingToggleAutostart
* @summary Enables or disables the autostart
* @description Enables or disables the autostart
*/
function settingToggleAutostart()
{
    // auto-launch - via: https://www.npmjs.com/package/auto-launch
    var AutoLaunch = require("auto-launch");

    var ttthAutoLauncher = new AutoLaunch({
        name: "ttth",
        useLaunchAgent: true,
    });

    // Handle depending on the checkbox state
    if($("#checkboxSettingAutostart").prop("checked"))
    {
        ttthAutoLauncher.enable();

        writeLocalStorage("settingAutostart", true);

        console.log("settingToggleAutostart ::: Finished enabling Autostart");
    }
    else
    {
        ttthAutoLauncher.disable();

        writeLocalStorage("settingAutostart", false);
        writeLocalStorage("settingAutostartMinimized", false);

        // adjust UI:
        // make sure check checkfor for AutostartStartMinimized is unchecked as well
        $("#checkboxSettingAutostartMinimized").prop("checked", false);

        console.log("settingToggleAutostart ::: Finished disabling Autostart");
    }

    ttthAutoLauncher.isEnabled()
    .then(function(isEnabled){
        if(isEnabled){
            return;
        }
        ttthAutoLauncher.enable();
    })
    .catch(function(err){
        // handle error
    });
}


/**
* @name settingToggleAutostartMinimized
* @summary Enables or disables the autostart minimized
* @description Enables or disables the autostart minimized
*/
function settingToggleAutostartMinimized()
{
    // auto-launch - via: https://www.npmjs.com/package/auto-launch
    var AutoLaunch = require("auto-launch");

    if($("#checkboxSettingAutostartMinimized").prop("checked"))
    {
        // enable start minimized
        var ttthAutoLauncher = new AutoLaunch({
        name: "ttth",
        isHidden: true,
        useLaunchAgent: true,
        });

        // Write AutoStart &amp; AutostartMinimized to local storage
        writeLocalStorage("settingAutostart", true);
        writeLocalStorage("settingAutostartMinimized", true);

        // adjust UI
        //
        // make sure general Autostart is checked as well
        $("#checkboxSettingAutostart").attr("checked", true);

        ttthAutoLauncher.enable();

        console.log("settingToggleAutostartMinimized ::: Finished enabling minimized Autostart");
    }
    else
    {
        // disable start minimized
        var ttthAutoLauncher = new AutoLaunch({
        name: "ttth",
        isHidden: false,
        useLaunchAgent: true,
        });

        // Write AutostartMinimized to local storage
        writeLocalStorage("settingAutostartMinimized", false);

        ttthAutoLauncher.enable();

        console.log("settingToggleAutostartMinimized ::: Finished disabling minimized Autostart");
    }
}


/**
* @name settingDefaultViewUpdate
* @summary Stores a new default view to local storage
* @description Users can define a default / startup view in settings. This method stores the users choice into local storage.
*/
function settingDefaultViewUpdate()
{
    // get currently selected value from select
    var newDefaultView = $( "#selectDefaultView" ).val();
    console.log("settingDefaultViewUpdate ::: New default view on start is set to: " + newDefaultView);

    // Store new default view in local storage
    writeLocalStorage("settingDefaultView", newDefaultView);
}


/**
* @name settingDefaultViewReset
* @summary Reset the stored default view
* @description Deletes the localstorage key 'settingDefaultview'
*/
function settingDefaultViewReset()
{
    // delete local storage key and its related value
    localStorage.removeItem("settingDefaultView");

    // reset the selection of the select item
    $("#selectDefaultView").prop("selectedIndex",0);

    console.log("settingDefaultViewReset ::: Did reset the default view");
}


/**
* @name settingToggleMenubarVisibility
* @summary Toggles the setting hideMenubar
* @description Enabled or disables the srtting Hide-Menubar-On-Startup
*/
function settingToggleMenubarVisibility()
{
    if($("#checkboxSettingHideMenubar").prop("checked"))
    {
        writeLocalStorage("settingHideMenubar", true);

        console.log("settingToggleMenubarVisibility ::: Hide menubar is enabled");

        // show noty
        showNoty("success", "Hide menubar on startup is now enabled (Settings).");
    }
    else
    {
        writeLocalStorage("settingHideMenubar", false);

        console.log("settingToggleMenubarVisibility ::: Hide menubar is disabled");

        // show noty
        showNoty("success", "Hide menubar on startup is now disabled (Settings).");
    }
}


/**
* @name checkSupportedOperatingSystem
* @summary Checks if the operating system is supported or not
* @description Checks if the operating system is linux, windows or macOS.
*/
function checkSupportedOperatingSystem()
{
    var supportedOperatingSystemMessage = "";
    var userPlatform = process.platform;

    console.log("checkSupportedOperatingSystem ::: Detected operating system as: " + userPlatform);

    switch(userPlatform)
    {
        case "win32":
        case "windows":
        case "linux":
        case "darwin":
            console.log("checkSupportedOperatingSystem ::: Operating system " + userPlatform + " is fine." );
            break;

        default:
            // define message
            supportedOperatingSystemMessage = "Support for " + userPlatform + " is experimental.";

            showNoty("warning", supportedOperatingSystemMessage, 0);

            console.error("checkSupportedOperatingSystem ::: Operating system " + userPlatform + " - " + supportedOperatingSystemMessage );
    }
}


/**
* @name switchToService
* @summary Activates a given service tab
* @description Activates the tab of a given service. Needed for handling DefaultView setting.
* @param serviceName - Name of the service
*/
function switchToService(serviceName)
{
    console.log("switchToService ::: Switching to tab: " + serviceName);

    // activate the related tab
    $("#target_" + serviceName).trigger("click");
}


/**
* @name searchUpdate
* @summary Checks if there is a new release available
* @description Compares the local app version number with the tag of the latest github release. Displays a notification in the settings window if an update is available.
* @param silent - Boolean with default value. Shows a feedback in case of no available updates If "silent" = false. Special handling for manually triggered update search
*/
function searchUpdate(silent = true)
{
    var remoteAppVersionLatest = "0.0.0";

    var gitHubPath = "yafp/ttth";  // user/repo
    var url = "https://api.github.com/repos/" + gitHubPath + "/tags";

    console.log("searchUpdate ::: Start checking " + url + " for available releases");

    var updateStatus = $.get( url, function( data )
    {
        timeout:3000; // in milliseconds

        // success
        var versions = data.sort(function (v1, v2)
        {
            return semver.compare(v2.name, v1.name);
        });

        // remote version
        var remoteAppVersionLatest = versions[0].name;
        //remoteAppVersionLatest = "66.1.2"; // overwrite variable to simulate available updates

        // local version
        var localAppVersion = require("electron").remote.app.getVersion();

        console.log("searchUpdate ::: Local version: " + localAppVersion);
        console.log("searchUpdate ::: Latest public version: " + remoteAppVersionLatest);

        if( localAppVersion &lt; remoteAppVersionLatest )
        {
            console.warn("searchUpdate ::: Found update, notify user");

            // update the updater-info text
            $("#updateInformation").html('ttth ' + remoteAppVersionLatest + ' is now available. See &lt;a href="#" onClick=\'openURL("https://github.com/yafp/ttth/blob/master/CHANGELOG.md")\'>Changelog&lt;/a> for details. Download is available &lt;a href="#" onClick=\'openURL("https://github.com/yafp/ttth/releases")\'>here&lt;/a>. &lt;button type="button" class="close" onClick="hideUpdateInformation();" aria-label="Close">&lt;span aria-hidden="true">&amp;times;&lt;/span>&lt;/button>');

            // show update information
            $("#updateInformation").show();

            // send notification
            //showNoty("success", "An update to version " + remoteAppVersionLatest + " is now available.", 0);
        }
        else
        {
            console.log("searchUpdate ::: No newer version found.");

            if(silent === true) // default case -> when executed on load
            {
                // hide update information
                $("#updateInformation").hide();

            }
            else // when executed manually via menu -> user should see result of this search
            {
                // update the updater-info text
                $("#updateInformation").html('You are running the latest version of ttth. &lt;button type="button" class="close" onClick="hideUpdateInformation();" aria-label="Close">&lt;span aria-hidden="true">&amp;times;&lt;/span>&lt;/button>');
            }
        }

        console.log("searchUpdate ::: Successfully checked " + url + " for available releases");
    })
    .done(function()
    {
        //console.log("searchUpdate ::: Successfully checked " + url + " for available releases");
    })

    .fail(function()
    {
        console.error("searchUpdate ::: Checking " + url + " for available releases failed.");

        $("#updateInformation").hide();

        showNoty("error", "Checking " + url + " for available releases failed. Got network issues?");
    })

    .always(function()
    {
        console.log("searchUpdate ::: Finished checking " + url + " for available releases");
    });
}


/**
* @name hideUpdateInformation
* @summary Hides the update information
* @description Hides the info div which shows hint regarding available update, link to changelog and link to release/download
*/
function hideUpdateInformation()
{
    console.log("hideUpdateInformation ::: Hiding update information div");

    // hide update information
    $("#updateInformation").hide();
}


/**
* @name loadDefaultView
* @summary Loads the default view
* @description Loads the default view
*/
function loadDefaultView()
{
    // read from local storage
    var curDefaultView = readLocalStorage("settingDefaultView");

    if(curDefaultView === null) // no default view configured
    {
        console.log("loadDefaultView ::: No default configured");
    }
    else
    {
        console.log("loadDefaultView ::: Found configured default view: " + curDefaultView);
        switchToService(curDefaultView);
    }
}


/**
* @name validateConfiguredDefaultView
* @summary Checks on startup if the service configured as default view is a valid / enabled service
* @description Checks if the default view is valid, otherwise fallbacks to settings view
*/
function validateConfiguredDefaultView()
{
    // read from local storage
    var curDefaultView = readLocalStorage("settingDefaultView");

    if(curDefaultView === null) // no default view configured
    {
        console.log("validateConfiguredDefaultView ::: No default configured - Stay on settings-view");
    }
    else
    {
        console.log("validateConfiguredDefaultView ::: Found configured default view: " + curDefaultView);

        // check if the configured service is enabled or not
        console.log("validateConfiguredDefaultView ::: Check if configured default view is an enabled service or not");

        var exists = false;

        // Check if Dropdown contains the defined default view as enabled service
        $("#selectDefaultView option").each(function()
        {
            if (this.value === curDefaultView)
            {
                exists = true;
                return false;
            }
        });

        if(exists)
        {
            console.log("validateConfiguredDefaultView ::: Configured default view is valid");

            // Update select
            $("#selectDefaultView").val(curDefaultView);

            // load the default view
            loadDefaultView();
        }
        else
        {
            console.log("validateConfiguredDefaultView ::: Fallback to default (setting-view)");

            // reset the selection of the select item
            $("#selectDefaultView").prop("selectedIndex",0);

            // delete the localstorage entry for defaultview
            settingDefaultViewReset();
        }
    }
}


/**
* @name openURL
* @summary Opens an url in browser
* @description Opens a given url in default browser
* @param url - URL string which contains the target url
*/
function openURL(url)
{
    const {shell} = require("electron");
    console.log("openURL ::: Trying to open the url: " + url);
    shell.openExternal(url);
}


/**
* @name loadServiceSpecificCode
* @summary Executes service specific javascript code on service-activation
* @description Executes service specific javascript code on service-activation
* @param serviceId
* @param serviceName - Name of the service
*/
function loadServiceSpecificCode(serviceId, serviceName)
{
    console.log("loadServiceSpecificCode ::: Checking for service-specific code for the service: " + serviceName + " with the id: _" + serviceId + "_.");

    switch (serviceName)
    {
        case "freenode":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, false, true);
            break;

        case "googleMail":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, true);
            break;

        case "googleMessages":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, true);
            break;

        case "mattermost":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, true);
            break;

         case "slack":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, true);
            break;

        case "telegram":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, true);
            break;

        case "threema":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, false);
            break;

        case "twitter":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, false);
            break;

        case "whatsapp":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            serviceWhatsAppRegister();
            addEventListenerForSingleService(serviceId, true, true);
            break;

        case "xing":
            console.log("loadServiceSpecificCode ::: Executing " + serviceName + " specific things");
            addEventListenerForSingleService(serviceId, true, false);
            break;

        default:
            console.log("loadServiceSpecificCode ::: Nothing to do here");
    }
}


/**
* @name initAvailableServicesSelection
* @summary fills the select item in settings-page (which features all supported services)
* @description fills the select item in settings-page (which features all supported services)
*/
function initAvailableServicesSelection()
{
    console.log("initAvailableServicesSelection ::: Reload settings select with all supported service definitions");

    var counterSupportedServices = 0;

    // get reference to select which contains all supported service type definitions
    let dropdown = $("#select_availableServices");

    // Empty the select
    dropdown.empty();

    // Add a disabled dummy/default entry
    dropdown.append('&lt;option selected="true" disabled>Choose a service&lt;/option>');
    dropdown.prop("selectedIndex", 0);

    // url to service definitions
    const url = __dirname + "/js/ttth/services.json";

    // Populate select with list of provinces
    $.getJSON(url, function (data)
    {
        $.each(data, function (key, entry)
        {
            // add option to select
            dropdown.append($("&lt;option>&lt;/option>").attr("value", entry.id).text(entry.nameLong));

            counterSupportedServices = counterSupportedServices +1;
        });

        console.log("initAvailableServicesSelection ::: Finished reloading settings select with all supported service definitions. Found _" + counterSupportedServices + "_ service types.");

    });
}


/**
* @name loadConfiguredUserServices
* @summary updates the settings view which shows all configured user services.
* @description removes all configured user services from settings view, reads all configured user services and re-adds
*/
function loadConfiguredUserServices()
{
    const storage = require("electron-json-storage");

    // empty the div
    $( "#settingsServicesConfigured" ).empty();

    // read all user service files
    storage.getAll(function(error, data)
    {
        if (error) throw error;

        // show object which contains all config files
        //console.error(data);
        //console.error(typeof data);

        var serviceCount = 0;

        // loop over upper object
        for (var key in data)
        {
            if (data.hasOwnProperty(key))
            {
                //console.log("loadConfiguredUserServices ::: " + key);
                console.log("loadConfiguredUserServices ::: " + key + " -> " + data[key]);

                // show 2 services per row
                if (serviceCount%2 === 0) // Odd
                {
                    // create a new row
                    $( "#settingsServicesConfigured" ).append('&lt;div class="row" id="conf_' + serviceCount + '">&lt;/div>');

                    if(data[key]["serviceEnableStatus"] === true) // show enabled configured service
                    {
                        //$( "#conf_" + serviceCount ).append('&lt;div class="col-sm-6">&lt;div class="input-group input-group-sm mb-1">&lt;div class="input-group-prepend">&lt;div class="input-group-text">&lt;input type="checkbox" id="checkbox_'+ key + '" name=' + key + ' checked onClick="settingsToggleSingleConfiguredUserServiceCheckbox(\''  + key + '\');">&lt;/div>&lt;/div>&lt;input type="text" class="form-control" id="label_' + data[key]["url"] + '" aria-label="Text input with checkbox" value='+ data[key]["name"] +' title=' + data[key]["url"] + ' disabled>&lt;div class="input-group-prepend">&lt;button type="button" class="btn btn-success btn-sm" id="bt_'+ key +'" title="enabled" disabled>&lt;i id=statusIconService_'+ key +' class="fas fa-toggle-on">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-danger btn-sm" id="bt_delete'+ key +'" title="delete" onClick="deleteConfiguredService(\''  + key + '\');">&lt;i class="fas fa-trash-alt">&lt;/i>&lt;/button>&lt;/div>&lt;/div>&lt;/div>');

                        $( "#conf_" + serviceCount ).append('&lt;div class="col-sm-6">&lt;div class="input-group input-group-sm mb-1">&lt;div class="input-group-prepend">&lt;div class="input-group-text">&lt;i class="' + data[key]["icon"] +'">&lt;/i>&lt;/div>&lt;/div>&lt;input type="text" class="form-control" id="label_' + data[key]["url"] + '" aria-label="Text input with checkbox" value='+ data[key]["name"] + ' title=' + data[key]["url"] + ' disabled>&lt;div class="input-group-prepend">&lt;button type="button" id="bt_configSingleService_'+ key +'" class="btn btn-dark" onClick="configureSingleUserService(\''  + key + '\')">&lt;i class="fas fa-cog">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-success btn-sm" id="bt_'+ key +'" title="enabled" onClick="settingsToggleSingleConfiguredUserServiceCheckbox(\''  + key + '\');">&lt;i id=statusIconService_'+ key +' class="fas fa-toggle-on">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-danger btn-sm" id="bt_delete'+ key +'" title="delete" onClick="deleteConfiguredService(\''  + key + '\');">&lt;i class="fas fa-trash-alt">&lt;/i>&lt;/button>&lt;/div>&lt;/div>&lt;/div>');

                    }
                    else // show disabled configured service
                    {
                        $( "#conf_" + serviceCount ).append('&lt;div class="col-sm-6">&lt;div class="input-group input-group-sm mb-1">&lt;div class="input-group-prepend">&lt;div class="input-group-text">&lt;i class="' + data[key]["icon"] +'">&lt;/i>&lt;/div>&lt;/div>&lt;input type="text" class="form-control" id="label_' + data[key]["url"] + '" aria-label="Text input with checkbox" value='+ data[key]["name"] +' title=' + data[key]["url"] + ' disabled>&lt;div class="input-group-prepend">&lt;button type="button" id="bt_configSingleService_'+ key +'" class="btn btn-dark" onClick="configureSingleUserService(\''  + key + '\')">&lt;i class="fas fa-cog">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-secondary btn-sm" id="bt_'+ key +'" title="disabled" onClick="settingsToggleSingleConfiguredUserServiceCheckbox(\''  + key + '\');">&lt;i id=statusIconService_'+ key +' class="fas fa-toggle-off">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-danger btn-sm" id="bt_delete'+ key +'" title="delete" onClick="deleteConfiguredService(\''  + key + '\');">&lt;i class="fas fa-trash-alt">&lt;/i>&lt;/button>&lt;/div>&lt;/div>&lt;/div>');
                    }
                }
                else // ...even - add to existing row - in col 2
                {
                    // add something to the existing row
                    var rowReference = serviceCount -1;

                    if(data[key]["serviceEnableStatus"] === true) // show enabled configured service
                    {
                        $( "#conf_" + rowReference  ).append('&lt;div class="col-sm-6">&lt;div class="input-group input-group-sm mb-1">&lt;div class="input-group-prepend">&lt;div class="input-group-text">&lt;i class="' + data[key]["icon"] +'">&lt;/i>&lt;/div>&lt;/div>&lt;input type="text" class="form-control" id="label_' + data[key]["url"] + '" aria-label="Text input with checkbox" value='+ data[key]["name"]+' title=' + data[key]["url"] + ' disabled>&lt;div class="input-group-prepend">&lt;button type="button" id="bt_configSingleService_'+ key +'" class="btn btn-dark" onClick="configureSingleUserService(\''  + key + '\')">&lt;i class="fas fa-cog">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-success btn-sm" id="bt_'+ key +'" title="enabled" onClick="settingsToggleSingleConfiguredUserServiceCheckbox(\''  + key + '\');">&lt;i id=statusIconService_'+ key +' class="fas fa-toggle-on">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-danger btn-sm" id="bt_delete'+ key +'" title="delete" onClick="deleteConfiguredService(\''  + key + '\');">&lt;i class="fas fa-trash-alt">&lt;/i>&lt;/button>&lt;/div>&lt;/div>&lt;/div>');

                    }
                    else // show disabled configured service
                    {
                        $( "#conf_" + rowReference  ).append('&lt;div class="col-sm-6">&lt;div class="input-group input-group-sm mb-1">&lt;div class="input-group-prepend">&lt;div class="input-group-text">&lt;i class="' + data[key]["icon"] +'">&lt;/i>&lt;/div>&lt;/div>&lt;input type="text" class="form-control" id="label_' + data[key]["url"] + '" aria-label="Text input with checkbox" value='+ data[key]["name"] +' title=' + data[key]["url"] + ' disabled>&lt;div class="input-group-prepend">&lt;button type="button" id="bt_configSingleService_'+ key +'" class="btn btn-dark" onClick="configureSingleUserService(\''  + key + '\')">&lt;i class="fas fa-cog">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-secondary btn-sm" id="bt_'+ key +'" title="disabled" onClick="settingsToggleSingleConfiguredUserServiceCheckbox(\''  + key + '\');">&lt;i id=statusIconService_'+ key +' class="fas fa-toggle-off">&lt;/i>&lt;/button>&lt;button type="button" class="btn btn-danger btn-sm" id="bt_delete'+ key +'" title="delete" onClick="deleteConfiguredService(\''  + key + '\');">&lt;i class="fas fa-trash-alt">&lt;/i>&lt;/button>&lt;/div>&lt;/div>&lt;/div>');
                    }
                }
                serviceCount = serviceCount +1;
            }
        }
    });

    console.log("loadConfiguredUserServices ::: Finished loading all configured user services to settings page");
}



/**
* @name initSettingsPage
* @summary Initializes the settings page
* @description Shows links to github informations. update informations. Initializes the service-checkboxes on loading the view
*/
function initSettingsPage()
{
    var curSettingAutostart;
    var curSettingAutostartMinimized;
    var curSettingHideMenubar;
    var curSettingUserColor;
    var curSettingUserColorCode;

    // load all supported services to checklist
    initAvailableServicesSelection();

    // load all user enabled services
    loadConfiguredUserServices();

    // Setting: Autostart
    //
    curSettingAutostart = readLocalStorage("settingAutostart");
    if(curSettingAutostart === "true")
    {
        console.log("initSettingsPage ::: Setting Autostart is configured");

        // activate checkbox
        $("#checkboxSettingAutostart").prop("checked", true);
    }
    else
    {
        console.log("initSettingsPage ::: Setting Autostart is not configured");
    }


    // Setting: AutostartMinimized
    //
    curSettingAutostartMinimized = readLocalStorage("settingAutostartMinimized");
    if(curSettingAutostartMinimized === "true")
    {
        console.log("initSettingsPage ::: Setting AutostartMinimized is configured");

        // activate checkbox
        $("#checkboxSettingAutostart").prop("checked", true);
        $("#checkboxSettingAutostartMinimized").prop("checked", true);
    }
    else
    {
        console.log("initSettingsPage ::: Setting AutostartMinimized is not configured");
    }


    // Setting: HideMenubar (is platform specific - as function is not supported on darwin)
    //
    const {ipcRenderer} = require("electron");
    curSettingHideMenubar = readLocalStorage("settingHideMenubar");

    if(isMac())
    {
        // ensure the setting is disabled
        writeLocalStorage("settingHideMenubar", "false");

        // hide the entire setting on settingspage
        $("#settingsSectionStartupHideMenubar").hide();
    }
    else // default case (linux or windows)
    {
        if(curSettingHideMenubar === "true")
        {
            // hide menubar
            console.log("initSettingsPage ::: Hide menubar");
            $("#checkboxSettingHideMenubar").prop("checked", true);
            ipcRenderer.send("hideMenubar");
        }
        else
        {
            // show menubar
            ipcRenderer.send("showMenubar");
            $("#checkboxSettingHideMenubar").prop("checked", false);
            console.log("initSettingsPage ::: Show menubar");
        }
    }
}


/**
* @name removeServiceTab
* @summary Remove a single tab from UI
* @description Removes the li item fromtab menu, removed the tab itself
* @param tabId
*/
function removeServiceTab(tabId)
{
    console.log("removeServiceTab ::: Starting to remove the tab: _" + tabId + "_.");

    // remove item from menu
    $("#menu_" + tabId).remove();

    // remove tabcontent from tab pane
    $("#" + tabId).remove();

    // remove service from select for DefaultView
    $("#selectDefaultView option[value=" + tabId + "]").remove();

    console.log("removeServiceTab ::: Finished removing the tab: _" + tabId + "_.");
}


/**
* @name addServiceTab
* @summary Add a single tab to UI
* @description Add the li item to tab menu, adds the tab itself
* @param serviceId
* @param serviceType
* @param serviceName
* @param serviceIcon
* @param serviceUrl
* @param serviceInjectCode
*/
function addServiceTab(serviceId, serviceType, serviceName, serviceIcon, serviceUrl, serviceInjectCode)
{
    console.log("addServiceTab ::: Starting to add the tab: _" + serviceId + "_.");

    // get amount of tabs
    var existingTabs = $("#myTabs li").length;

    // calculate new tab position
    var newTabPosition = existingTabs -2;

    // add new list item to unordner list (tabs/menu)
    //
    $('#myTabs li:eq(' + newTabPosition + ')').after('&lt;li class="nav-item small" id=menu_'+ serviceId +'>&lt;a class="nav-link my-ui-text" id=target_' + serviceId +' href=#' + serviceId + ' role="tab" data-toggle="tab">&lt;i class="' + serviceIcon +'">&lt;/i> ' + serviceName + ' &lt;span id=badge_' + serviceId + ' class="badge badge-success">&lt;/span>&lt;/a>&lt;/li>');
    console.log("addServiceTab :::Added the navigation tab for service: _" + serviceId + "_.");

    // add the tab itself to #tabPanes
    $( "#tabPanes" ).append( '&lt;div role="tabpanel" class="tab-pane fade flex-fill resizer container-fluid" id=' + serviceId + '>&lt;/div>' );
    console.log("addServiceTab :::Added the tab pane for service: _" + serviceId + "_.");

    // add webview  to new tab
    $( "#"+ serviceId ).append( '&lt;webview id=webview_' + serviceId + ' class="resizer" src=' + serviceUrl + ' preload='+ serviceInjectCode + ' userAgent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36">&lt;/webview>' );
    console.log("addServiceTab :::Added the webview to the tab pane for service: _" + serviceId + "_.");

    console.log("addServiceTab ::: Finished adding the tab: _" + serviceId + "_.");

    // add service to select for DefaultView
    $("#selectDefaultView").append(new Option(serviceName, serviceId));

    loadServiceSpecificCode(serviceId, serviceType);
}


/**
* @name settingsToggleSingleConfiguredUserServiceCheckbox
* @summary Enables or disabled the status of a single user configured service
* @description User can enable or disable his configured services in settings page.
* @param configuredUserServiceConfigName - Name of the config file of the selected service
*/
function settingsToggleSingleConfiguredUserServiceCheckbox(configuredUserServiceConfigName)
{
    console.log("settingsToggleSingleConfiguredUserServiceCheckbox ::: Toggling the configured service defined in config file: _" + configuredUserServiceConfigName + "_.");

    const os = require("os");
    const storage = require("electron-json-storage");
    const dataPath = storage.getDataPath();

    var serviceEnableStatus;

    var type;
    var name;
    var icon;
    var url;
    var injectCode;

    // get content from service configuration file
    storage.get(configuredUserServiceConfigName, function(error, data) {
        if (error) throw error;

        type = data.type;
        name = data.name;
        icon = data.icon;
        url =  data.url;
        injectCode = data.injectCode;


        // get status of enable/disable button:
        if( $("#bt_" + configuredUserServiceConfigName).attr("title") === "enabled")
        {
            // is enabled - so disable it

            // Status Button
            //
            // update button type
            $("#bt_" + configuredUserServiceConfigName).removeClass();
            $("#bt_" + configuredUserServiceConfigName).addClass("btn btn-secondary btn-sm");
            // update button title
            $("#bt_" + configuredUserServiceConfigName).prop("title", "disabled");
            // update button icon
            $("#statusIconService_" + configuredUserServiceConfigName).removeClass();
            $("#statusIconService_" + configuredUserServiceConfigName).addClass("fas fa-toggle-off");

            // set serviceEnableStatus variable
            serviceEnableStatus = false;

            // remove service tab
            removeServiceTab(configuredUserServiceConfigName);

            console.log("settingsToggleSingleConfiguredUserServiceCheckbox ::: Service _" + configuredUserServiceConfigName + "_ is now disabled.");
        }
        else {
            // is disabled - so enable it

            // Status Button
            //
            // update button type
            $("#bt_" + configuredUserServiceConfigName).removeClass();
            $("#bt_" + configuredUserServiceConfigName).addClass("btn btn-success btn-sm");
            // update button title
            $("#bt_" + configuredUserServiceConfigName).prop("title", "enabled");
            // update button icon
            $("#statusIconService_" + configuredUserServiceConfigName).removeClass();
            $("#statusIconService_" + configuredUserServiceConfigName).addClass("fas fa-toggle-on");

            // set serviceEnableStatus variable
            serviceEnableStatus = true;

            // add tab for this enabled service
            addServiceTab(configuredUserServiceConfigName, type, name, icon, url, injectCode);

            // add service to selectDefaultView
            $("#selectDefaultView").append(new Option(name, configuredUserServiceConfigName));

            console.log("settingsToggleSingleConfiguredUserServiceCheckbox ::: Service _" + configuredUserServiceConfigName + "_ is now enabled.");
        }

        // update the config of the configured service (status)
        storage.set(configuredUserServiceConfigName, {
            "type": type,
            "name": name,
            "icon": icon,
            "url": url,
            "injectCode": injectCode,
            serviceEnableStatus: serviceEnableStatus
        }, function(error)
        {
            if (error) throw error;
        });
    });

    console.log("settingsToggleSingleConfiguredUserServiceCheckbox ::: Service _" + configuredUserServiceConfigName + "_ config file is now updated (status)");
}


/**
* @name loadEnabledUserServices
* @summary Reads all user configured service files and adds the enabled ones
* @description Reads all user configured service files and adds the enabled ones
*/
function loadEnabledUserServices()
{
    const storage = require("electron-json-storage");

    console.log("loadEnabledUserServices ::: Starting to fetch all user configured service files");

    // loop over all json files - add tab for the enabled ones
    storage.getAll(function(error, data)
    {
        if (error) throw error;

        // show object which contains all config files
        console.log("loadEnabledUserServices ::: Current service: " + data);

        // loop over upper object
        for (var key in data)
        {
            if (data.hasOwnProperty(key))
            {
                console.log("loadEnabledUserServices ::: " + key);
                console.log("loadEnabledUserServices ::: " + key + " -> " + data[key]);

                if(data[key]["serviceEnableStatus"] === true) // show enabled configured service
                {
                    console.log("loadEnabledUserServices ::: Trying to add the enabled service: _" + key + "_.");
                    addServiceTab(key, data[key]["type"], data[key]["name"], data[key]["icon"], data[key]["url"], data[key]["injectCode"]);

                    // add service to selectDefaultView
                    //$("#selectDefaultView").append(new Option(data[key]["name"], key));
                }
                else
                {
                    console.log("loadEnabledUserServices ::: Skipped service: _" + key + "_, as it not enabled.");
                }
            }
        }
        console.log("loadEnabledUserServices ::: Finished current service: " + data);
    });
}


/**
* @name deleteConfiguredService
* @summary Deletes a single configured user service
* @description Removes the tab, deletes the service user config, reloads the settings view which shows all user configured services.
*/
function deleteConfiguredService(serviceId)
{
    console.log("deleteConfiguredService ::: Deleting the user service: _" + serviceId + "_.");

    // remove tab
    removeServiceTab(serviceId);

    // delete config
    const storage = require("electron-json-storage");
    storage.remove(serviceId, function(error) {
      if (error) throw error;
    });

    // reload all configured user services to settings page
    loadConfiguredUserServices();

    console.log("deleteConfiguredService ::: Finished deleting the user service: _" + serviceId + "_.");
}


/**
* @name settingsUserAddNewService
* @summary user wants to configure a new service
* @description user wants to configure a new service
*/
function settingsUserAddNewService()
{
    console.log("settingsUserAddNewService ::: Starting to add a new user configured service.");

    const os = require("os");
    const storage = require("electron-json-storage");
    const dataPath = storage.getDataPath();

    var serviceAllowsMultipleInstances;

    // get selected option from #select_availableServices
    var userSelectedService = $( "#select_availableServices" ).val();
    console.log("settingsUserAddNewService ::: Selected service type is: _" + userSelectedService + "_.");

    if( userSelectedService !== null )
    {
        console.log("settingsUserAddNewService ::: Should add a new service of type: _" + userSelectedService + "_.");

        // check if this service allows multiple instances
        console.log("settingsUserAddNewService ::: Checking if the service: _" + userSelectedService + "_ allows multiple instances");
        // Parse service template
        const url = __dirname + "/js/ttth/services.json";
        $.getJSON(url, function (data)
        {
            $.each(data, function (key, entry)
            {
                if(entry.id === userSelectedService)
                {
                    // check if it allows multiple instances
                    if(entry.multiple === true)
                    {
                        console.log("settingsUserAddNewService ::: Service: _" + userSelectedService + "_ allows multiple instances");
                        serviceAllowsMultipleInstances = true;

                        createServiceFile(userSelectedService, entry.name, entry.icon, entry.url, entry.injectCode)
                    }
                    else // single instance service
                    {
                        console.warn("settingsUserAddNewService ::: Service: _" + userSelectedService + "_ does NOT allows multiple instances");
                        console.log("settingsUserAddNewService ::: Check if there already exists an instance of the service type: _" + userSelectedService + "_.");

                        // check if there is already a configured service of that type.
                        // check which configs already exist
                        storage.getAll(function(error, data)
                        {
                            if (error) throw error;

                            // show object which contains all config files
                            console.log(data);
                            //console.error(typeof data);

                            for (var key in data)
                            {
                                if (data.hasOwnProperty(key))
                                {
                                    //console.log(key + " -> " + data[key]);
                                    //console.warn(data[key]);

                                    console.log(data[key]["type"]);

                                    if(data[key]["type"] === userSelectedService)
                                    {
                                        const { dialog } = require("electron").remote;

                                        const options = {
                                            type: "warning",
                                            buttons: ["OK"],
                                            icon: __dirname + "/img/icon/icon.png",
                                            defaultId: 0,
                                            title: "Adding a service failed",
                                            message: "There is already a configured service of the type " + userSelectedService + ".",
                                            //detail: 'It does not really matter',
                                            //checkboxLabel: 'Remember my answer',
                                            //checkboxChecked: true,
                                        };

                                        dialog.showMessageBox(null, options, (response, checkboxChecked) => {
                                            console.log(response);
                                            console.log(checkboxChecked);
                                        });

                                        return;
                                    }
                                }
                            }

                            createServiceFile(userSelectedService, entry.name, entry.icon, entry.url, entry.injectCode);
                        });

                    }
                }
            });
        });
    }
    else
    {
        console.warn("settingsUserAddNewService ::: No service type selected. Unable to add a new service.");
        showNoty("error", "No service type selected. Unable to add a new service.");
    }
}




//  generates a local file for each user configured service in the DataDir
/**
* @name createServiceFile
* @summary creates the .json file for a new user configured service
* @description creates the .json file for a new user configured service
* @param serviceType
* @param serviceName
* @param serviceIcon
* @param serviceUrl
* @param serviceInjectCode
*/
function createServiceFile(serviceType, serviceName, serviceIcon, serviceUrl, serviceInjectCode)
{
    console.log("createServiceFile ::: Starting to create a new .json file for a user configured service");

    const os = require("os");
    const storage = require("electron-json-storage");
    const dataPath = storage.getDataPath();

    // generate a random id (used as filename) for the new service:
    var randomString = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    var newServiceId = randomString + "_" + serviceType;

    const prompt = require("electron-prompt");

    prompt({
        title: "Service: " + serviceType,
        label: "Please insert your &lt;b>URL&lt;/b>.",
        value: serviceUrl,
        useHtmlLabel: true,
        resizable: false,
        width: 450,
        height: 200,
        inputAttrs: {
            type: "url",
            required: true,
            placeholder: "https://example.com"
        },
        icon: __dirname + "/img/icon/icon.png",
        menuBarVisible: false
    })
    .then((r) => {
        if( (r === null) || (r === "") )
        {
            // User cancelled the URL dialog or confirmed empty input.");
        }
        else
        {
            serviceUrl = r;

            // do everything
            storage.set( newServiceId,
            {
                serviceEnableStatus: true,
                type: serviceType,
                name: serviceName,
                icon: serviceIcon,
                url: serviceUrl,
                injectCode: serviceInjectCode

            }, function(error)
            {
                if (error) throw error;
            });

            // FIXME
            // is broken
            addServiceTab(newServiceId, serviceType, serviceName, serviceIcon, serviceUrl, serviceInjectCode);
            loadConfiguredUserServices();
        }
    })
    .catch(console.error);

    console.log("createServiceFile ::: Finished creation of .json file for a user configured service");
}


/**
* @name setAccesskeysForEnabledServices
* @summary Assigns accesskeys for all service tabs
* @description Assigns accesskeys for all service tabs
*/
function setAccesskeysForEnabledServices()
{
    console.log("setAccesskeysForEnabledServices ::: Starting to define accesskeys for enabled services");

    var tabCounter = 0;

    // get list of all visible service-tabs
    $("#myTabs li a").each(function()
    {
        currentTabId = $(this).attr("id");

        if(currentTabId !== "target_Settings")
        {
            tabCounter = tabCounter +1;

            console.log("setAccesskeysForEnabledServices ::: Set accesskey for tab: _" + currentTabId + "_ to: _" + tabCounter + "_.");
            $("#" + currentTabId).attr("accesskey", tabCounter);
        }
        else {
            console.log("setAccesskeysForEnabledServices ::: Ignoring settings tab.");
        }
    });

    // show notification
    if(tabCounter > 0) // if at least 1 accesskey was set
    {
        //showNoty("success", "Updating accesskeys for enabled service tabs.")
    }

    console.log("setAccesskeysForEnabledServices ::: Finished assigning accesskeys for enabled services &amp; related tabs");
}


/**
* @name localizeUserInterface
* @summary Localizes the user interface
* @description Is using i18next to localize the user interface. Translations are located in app/locales
*/
function localizeUserInterface()
{
    var userLang = navigator.language || navigator.userLanguage;

    // for development screenshot - overwrite the language to EN if the project is not packaged
    const isDev = require("electron-is-dev");
    if (isDev)
    {
        userLang = "en";
    }

    console.log("localizeUserInterface ::: Detected user language: " + userLang);

    var i18next = require("i18next");
    var Backend = require("i18next-sync-fs-backend");
    //var LanguageDetector = require("i18next-electron-language-detector");

    i18next
    .use(Backend)
    //.use(LanguageDetector)
    .init({
        debug: true,
        whitelist: ["en", "de"],
        lng: userLang,
        fallbackLng: "en",
        ns: "translation",
        defaultNS: "translation",
        updateMissing: false,
        initImmediate: true,
        backend:
        {
            // path where resources get loaded from
            loadPath: __dirname + "/locales/{{lng}}/{{ns}}.json",

            // path to post missing resources
            addPath: __dirname +  "/locales/{{lng}}/{{ns}}.missing.json",

            // jsonIndent to use when storing json files
            jsonIndent: 2
        }
    });

    $(function()
    {
        $("[i18n-text]").each(function()
        {
            var node = $(this), key = node.attr("i18n-text");
            node.text(i18next.t(key));
        });
        $("[i18n-title]").each(function()
        {
            var node = $(this), key = node.attr("i18n-title");
            node.attr("title", i18next.t(key));
        });
    });
}


// Call from main.js ::: reloadCurrentService
//
require("electron").ipcRenderer.on("reloadCurrentService", function(event, message)
{
    //console.log(message);  // Prints "whoooooooh!"

    // get href of current active tab
    var tabValue = $(".nav-tabs .active").attr("href");
    tabValue = tabValue.substring(1); // cut the first char ( =  #)
    console.log("reloadCurrentService ::: Current active tab is: " + tabValue);

    const storage = require("electron-json-storage");

    storage.get(tabValue, function(error, data) {
        if (error) throw error;

        url =  data.url;
        injectCode = data.injectCode;

        //console.log(data);
        document.getElementById( "webview_" + tabValue ).loadURL(url);

        // TODO
        // inject code
    });
});


// Call from main.js ::: showSettings
//
require("electron").ipcRenderer.on("showSettings", function(event)
{
    console.log("showSettings ::: Switching to Settings tab");
    switchToService("Settings");
});


// Call from main.js ::: startSearchUpdates
//
require("electron").ipcRenderer.on("startSearchUpdates", function(event)
{
    console.log("startSearchUpdates ::: Show update information div");

    // show update information
    $("#updateInformation").show();

    searchUpdate(false);
});


// Call from main.js ::: nextTab
//
require("electron").ipcRenderer.on("nextTab", function(event)
{
    // variables
    var currentTabId;
    var enabledTabsArray = []; // should store all visible names
    var currentActiveTabId; // Id of active tab
    var serviceName; // used to call  the function switchToService()

    // get current selected / active tab
    currentActiveTabId = $(".nav-item .active").attr("id");
    currentActiveTabId = currentActiveTabId.replace("target_", "");
    console.log("nextTab ::: Active tab is: " + currentActiveTabId);

    // get list of all visible service-tabs
    $("#myTabs li a").each(function()
    {
        currentTabId = $(this).attr("id");

        // check if entry is visible or not
        if($("#"+currentTabId).is(":visible"))
        {
            currentTabId = currentTabId.replace("target_", "");
            if(currentTabId !== "Settings")
            {
                enabledTabsArray.push(currentTabId);
            }
        }
    });

    // find position of current tab in the array of enabled services
    var currentPositionInArray = enabledTabsArray.indexOf(currentActiveTabId);

    // get next array position
    if(currentPositionInArray &lt; enabledTabsArray.length -1) //
    {
        serviceName = enabledTabsArray[currentPositionInArray+1];
    }
    else
    {
        serviceName = enabledTabsArray[0];
    }

    console.log("nextTab ::: Should switch to: " + serviceName + " now.");

    // jump to next tab
    switchToService(serviceName);
});


// Call from main.js ::: previousTab
//
require("electron").ipcRenderer.on("previousTab", function(event)
{
    // variables
    var currentTabId;
    var enabledTabsArray = []; // should store all visible names
    var currentActiveTabId; // Id of active tab
    var serviceName; // used to call  the function switchToService()

    // get current selected / active tab
    currentActiveTabId = $(".nav-item .active").attr("id");
    currentActiveTabId = currentActiveTabId.replace("target_", "");
    console.log("previous ::: Active tab is: " + currentActiveTabId);

    // get list of all visible service-tabs
    $("#myTabs li a").each(function()
    {
        currentTabId = $(this).attr("id");

        // check if entry is visible or not
        if($("#"+currentTabId).is(":visible"))
        {
            currentTabId = currentTabId.replace("target_", "");
            if(currentTabId !== "Settings")
            {
                enabledTabsArray.push(currentTabId);
            }
        }
    });

    // find position of current tab in the array of enabled services
    var currentPositionInArray = enabledTabsArray.indexOf(currentActiveTabId);

    // get previous array position
    if(currentPositionInArray > 0) //
    {
        serviceName = enabledTabsArray[currentPositionInArray-1];
    }
    else
    {
        serviceName = enabledTabsArray[enabledTabsArray.length -1];
    }

    console.log("previousTab ::: Should switch to: " + serviceName + " now.");

    // jump to previous tab
    switchToService(serviceName);
});


// Call from main.js ::: serviceToConfigure (in configServiceWindow)
//
require("electron").ipcRenderer.on("serviceToConfigure", function(event, serviceId)
{
    const storage = require("electron-json-storage");

    console.log("serviceToConfigure ::: Should configure the service: " + serviceId);
    console.log("serviceToConfigure ::: Loading current values from service config");

    storage.get(serviceId, function(error, data) {
        if (error) throw error;

        type = data.type;
        name = data.name;
        icon = data.icon;
        url =  data.url;
        injectCode = data.injectCode;
        status = data.serviceEnableStatus;

        // update UI of second window
        $("#input_serviceId").val(serviceId);
        $("#input_serviceType").val(type);
        $("#input_serviceName").val(name);
        $("#input_serviceIcon").val(icon);
        $("#input_serviceUrl").val(url);
        $("#input_serviceInjectCode").val(injectCode);
        $("#input_serviceEnableStatus").val(status);

        // hide Add-new-service button
        $("bt_addNewService").hide();

        console.log("serviceToConfigure ::: Loaded current values for this service to UI");

    });
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addEventListenerForSingleService">addEventListenerForSingleService</a></li><li><a href="global.html#addServiceTab">addServiceTab</a></li><li><a href="global.html#changeUserAgent">changeUserAgent</a></li><li><a href="global.html#checkSupportedOperatingSystem">checkSupportedOperatingSystem</a></li><li><a href="global.html#closeSingleServiceConfiguratationWindow">closeSingleServiceConfiguratationWindow</a></li><li><a href="global.html#configureSingleUserService">configureSingleUserService</a></li><li><a href="global.html#createMenu">createMenu</a></li><li><a href="global.html#createServiceFile">createServiceFile</a></li><li><a href="global.html#createSingleServiceConfiguration">createSingleServiceConfiguration</a></li><li><a href="global.html#createTray">createTray</a></li><li><a href="global.html#createWindow">createWindow</a></li><li><a href="global.html#deleteConfiguredService">deleteConfiguredService</a></li><li><a href="global.html#forceSingleAppInstance">forceSingleAppInstance</a></li><li><a href="global.html#hideUpdateInformation">hideUpdateInformation</a></li><li><a href="global.html#initAvailableServicesSelection">initAvailableServicesSelection</a></li><li><a href="global.html#initSettingsPage">initSettingsPage</a></li><li><a href="global.html#isMac">isMac</a></li><li><a href="global.html#loadConfiguredUserServices">loadConfiguredUserServices</a></li><li><a href="global.html#loadDefaultView">loadDefaultView</a></li><li><a href="global.html#loadEnabledUserServices">loadEnabledUserServices</a></li><li><a href="global.html#loadServiceSpecificCode">loadServiceSpecificCode</a></li><li><a href="global.html#localizeUserInterface">localizeUserInterface</a></li><li><a href="global.html#openDevTools">openDevTools</a></li><li><a href="global.html#openURL">openURL</a></li><li><a href="global.html#readLocalStorage">readLocalStorage</a></li><li><a href="global.html#removeServiceTab">removeServiceTab</a></li><li><a href="global.html#searchUpdate">searchUpdate</a></li><li><a href="global.html#sendNotification">sendNotification</a></li><li><a href="global.html#serviceGoogleMailGetUnreadMessageCount">serviceGoogleMailGetUnreadMessageCount</a></li><li><a href="global.html#serviceGoogleMessagesGetUnreadMessageCount">serviceGoogleMessagesGetUnreadMessageCount</a></li><li><a href="global.html#serviceMattermostGetUnreadMessageCount">serviceMattermostGetUnreadMessageCount</a></li><li><a href="global.html#serviceMattermostInit">serviceMattermostInit</a></li><li><a href="global.html#serviceSlackGetUnreadMessageCount">serviceSlackGetUnreadMessageCount</a></li><li><a href="global.html#serviceTelegramGetUnreadMessageCount">serviceTelegramGetUnreadMessageCount</a></li><li><a href="global.html#serviceThreemaGetUnreadMessageCount">serviceThreemaGetUnreadMessageCount</a></li><li><a href="global.html#serviceTwitterGetUnreadMessageCount">serviceTwitterGetUnreadMessageCount</a></li><li><a href="global.html#serviceWhatsAppGetUnreadMessageCount">serviceWhatsAppGetUnreadMessageCount</a></li><li><a href="global.html#serviceWhatsAppInit">serviceWhatsAppInit</a></li><li><a href="global.html#serviceWhatsAppRegister">serviceWhatsAppRegister</a></li><li><a href="global.html#serviceXingGetUnreadMessageCount">serviceXingGetUnreadMessageCount</a></li><li><a href="global.html#setAccesskeysForEnabledServices">setAccesskeysForEnabledServices</a></li><li><a href="global.html#settingDefaultViewReset">settingDefaultViewReset</a></li><li><a href="global.html#settingDefaultViewUpdate">settingDefaultViewUpdate</a></li><li><a href="global.html#settingsToggleSingleConfiguredUserServiceCheckbox">settingsToggleSingleConfiguredUserServiceCheckbox</a></li><li><a href="global.html#settingsUserAddNewService">settingsUserAddNewService</a></li><li><a href="global.html#settingToggleAutostart">settingToggleAutostart</a></li><li><a href="global.html#settingToggleAutostartMinimized">settingToggleAutostartMinimized</a></li><li><a href="global.html#settingToggleMenubarVisibility">settingToggleMenubarVisibility</a></li><li><a href="global.html#showNoty">showNoty</a></li><li><a href="global.html#switchToService">switchToService</a></li><li><a href="global.html#updateServiceBadge">updateServiceBadge</a></li><li><a href="global.html#updateSingleServiceConfiguration">updateSingleServiceConfiguration</a></li><li><a href="global.html#updateTrayIconStatus">updateTrayIconStatus</a></li><li><a href="global.html#updateWindowTitle">updateWindowTitle</a></li><li><a href="global.html#validateConfiguredDefaultView">validateConfiguredDefaultView</a></li><li><a href="global.html#writeLocalStorage">writeLocalStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jul 04 2019 20:56:24 GMT+0200 (Mitteleuropäische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
